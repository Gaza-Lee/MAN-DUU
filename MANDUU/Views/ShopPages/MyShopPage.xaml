<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:icons="clr-namespace:MANDUU.Helpers"
             xmlns:models="clr-namespace:MANDUU.Models"
             x:Class="MANDUU.Views.ShopPages.MyShopPage"
             Shell.TabBarIsVisible="False"
             Title="My Shops"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <Grid RowDefinitions="*, Auto" Padding="0,10,0,0">
        <!-- Shop Collection -->
        <CollectionView ItemsSource="{Binding UserShops}"
                        x:Name="ShopCollectionView"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding SelectedShopCommand}"
                        SelectionChangedCommandParameter="{Binding SelectedItem, Source={x:Reference ShopCollectionView}}"
                        Grid.Row="0"
                        Margin="10,0">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Shop">
                    <Border StrokeThickness="0"
                            StrokeShape="RoundRectangle 12"
                            BackgroundColor="{StaticResource PrimaryLight400}"
                            Padding="12"
                            Margin="0">

                        <Border.Shadow>
                            <Shadow Brush="{AppThemeBinding 
                                        Light={StaticResource White}, 
                                        Dark={StaticResource Gray900}}"
                                    Offset="0,2"
                                    Radius="8"
                                    Opacity="0.2"/>
                        </Border.Shadow>

                        <Grid ColumnDefinitions="140,*,Auto" ColumnSpacing="12" RowDefinitions="Auto">

                            <!-- Shop Image -->
                            <Border HeightRequest="180"
                                    WidthRequest="140"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 8"
                                    Grid.Column="0">
                                <Image Source="{Binding ShopProfileImage}"
                                       Aspect="AspectFill"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill"/>
                            </Border>

                            <!-- Shop Info -->
                            <VerticalStackLayout Grid.Column="1" Spacing="6" VerticalOptions="Center">
                                <Label Text="{Binding Name}"
                                       Style="{StaticResource Title}"
                                       FontSize="20"/>

                                <HorizontalStackLayout Spacing="6" VerticalOptions="Start">
                                    <Label Text="{x:Static icons:Icons.locationIcon}"
                                           FontSize="18"
                                           FontFamily="MaterialIcon"
                                           TextColor="{AppThemeBinding 
                                               Light={StaticResource Gray500}, 
                                               Dark={StaticResource Gray400}}"/>
                                    <Label Text="{Binding ShortLocation}"
                                           FontSize="14"
                                           TextColor="{AppThemeBinding 
                                               Light={StaticResource Gray600}, 
                                               Dark={StaticResource Gray300}}"/>
                                </HorizontalStackLayout>

                                <!-- Edit Button -->
                                <Border BackgroundColor="#6200EE"
                                        StrokeShape="RoundRectangle 5"
                                        Padding="12,6,18,6"
                                        StrokeThickness="0"
                                        HorizontalOptions="Start"
                                        VerticalOptions="End"
                                        Margin="0,8,0,0">
                                    <Border.Shadow>
                                        <Shadow Offset="2,2" Opacity="0.3" Brush="Black"/>
                                    </Border.Shadow>
                                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                        <Label Text="{x:Static icons:Icons.pickerIcon}"
                                               Style="{StaticResource MaterialIcon}"
                                               TextColor="{StaticResource White}"/>
                                        <Label Text="Edit"
                                               Style="{StaticResource ButtonLabelText}"/>
                                    </HorizontalStackLayout>
                                </Border>

                                <!-- Dashboard Button -->
                                <Border BackgroundColor="{StaticResource Primary}"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8"
                                        StrokeThickness="0"
                                        HorizontalOptions="Start"
                                        VerticalOptions="End"
                                        Margin="0,4,0,0">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding BindingContext.GoToDashboardCommand, Source={x:Reference ShopCollectionView}}" 
                                                              CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>
                                    <Border.Shadow>
                                        <Shadow Offset="2,2" Opacity="0.3" Brush="Black"/>
                                    </Border.Shadow>
                                    <HorizontalStackLayout Spacing="5" VerticalOptions="Center">
                                        <Label Text="Dashboard"
                                               Style="{StaticResource ButtonLabelText}"/>
                                        <Label Text="{x:Static icons:Icons.getStartedIcon}"
                                              Style="{StaticResource MaterialIcon}"
                                               TextColor="{StaticResource White}"/>
                                    </HorizontalStackLayout>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Delete Icon -->
                            <Label Grid.Column="2"
                                   Text="{x:Static icons:Icons.removeIcon}"
                                   FontFamily="MaterialIcon"
                                   FontSize="22"
                                   TextColor="Red"
                                   VerticalOptions="Start"
                                   HorizontalOptions="End"
                                   Margin="0,4,4,0">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.RemoveShopCommand, Source={x:Reference ShopCollectionView}}"
                                                          CommandParameter="{Binding .}"/>
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Floating Action Button Style - Create Shop -->
        <Border Grid.Row="1"
                Margin="20"
                Padding="16,10"
                BackgroundColor="{AppThemeBinding 
                    Light={StaticResource Primary}, 
                    Dark={StaticResource PrimaryDark}}"
                StrokeShape="RoundRectangle 28"
                HorizontalOptions="Center"
                VerticalOptions="End"
                StrokeThickness="0">

            <Border.Shadow>
                <Shadow Offset="0,4"
                        Radius="12"
                        Opacity="0.3"
                        Brush="{AppThemeBinding Light=Black, Dark=Gray}"/>
            </Border.Shadow>

            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding CreateNewShopCommand}"/>
            </Border.GestureRecognizers>

            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                <Border WidthRequest="28"
                        HeightRequest="28"
                        StrokeShape="Ellipse"
                        BackgroundColor="{AppThemeBinding 
                            Light={StaticResource White}, 
                            Dark={StaticResource Gray950}}"
                        HorizontalOptions="Center"
                        VerticalOptions="Center">
                    <Label Text="+"
                           FontSize="22"
                           TextColor="{AppThemeBinding 
                               Light={StaticResource Primary}, 
                               Dark={StaticResource PrimaryDark}}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           VerticalTextAlignment="Center"
                           HorizontalTextAlignment="Center"/>
                </Border>
                <Label Text="Create New Shop"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding 
                           Light={StaticResource White}, 
                           Dark={StaticResource Gray100}}"
                       VerticalOptions="Center"/>
            </HorizontalStackLayout>
        </Border>
    </Grid>
</ContentPage>