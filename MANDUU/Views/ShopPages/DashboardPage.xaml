<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:icon="clr-namespace:MANDUU.Helpers"
             xmlns:model="clr-namespace:MANDUU.Models"
             x:Class="MANDUU.Views.ShopPages.DashboardPage"
             Title="Dashboard"
             Shell.TabBarIsVisible="False">

    <Grid RowDefinitions="Auto, *" Margin="16,0" RowSpacing="24">

        <!-- HEADER SECTION -->
        <Grid ColumnDefinitions="*, Auto" ColumnSpacing="20" HorizontalOptions="Fill">

            <!-- Shop Info + Profile Image -->
            <VerticalStackLayout Spacing="2" >
                <Label Text="{Binding Shop.Name}"
                       Style="{StaticResource Title}"
                       FontSize="24"
                       TextColor="{StaticResource Primary}"
                       Margin="10,0"/>

                <Border StrokeThickness="0"
                        StrokeShape="RoundRectangle 16"
                        HeightRequest="160"
                        MinimumWidthRequest="300"
                        HorizontalOptions="Start">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.1" Radius="12" Offset="2,4"/>
                    </Border.Shadow>
                    <Image Source="{Binding Shop.ShopProfileImage}"
                           Aspect="AspectFill"
                           HorizontalOptions="Fill"
                           VerticalOptions="Fill"/>
                </Border>
            </VerticalStackLayout>

            <!-- Action Buttons -->
            <Grid Grid.Column="1" RowDefinitions="Auto, Auto, Auto" RowSpacing="10" VerticalOptions="Center">

                <!-- Analytics -->
                <VerticalStackLayout Grid.Row="0" HorizontalOptions="Center">
                    <Border StrokeThickness="0"
                            StrokeShape="RoundRectangle 25"
                            BackgroundColor="#E0E0E0"
                            HeightRequest="50"
                            WidthRequest="50"
                            HorizontalOptions="Center">
                        <Label Text="{x:Static icon:Icons.analyticsIcon}"
                               FontFamily="MaterialIcon"
                               VerticalTextAlignment="Center"
                               HorizontalTextAlignment="Center"
                               FontSize="24"
                               TextColor="{StaticResource Primary}"/>
                    </Border>
                    <Label Text="Analytics"
                           FontSize="12"
                           HorizontalOptions="Center"
                           TextColor="Gray"/>
                </VerticalStackLayout>

                <!-- Delete Product -->
                <VerticalStackLayout Grid.Row="1" HorizontalOptions="Center">
                    <Border StrokeThickness="0"
                            StrokeShape="RoundRectangle 25"
                            BackgroundColor="#FFE0E0"
                            HeightRequest="50"
                            WidthRequest="50"
                            HorizontalOptions="Center">
                        <Label Text="{x:Static icon:Icons.deleteIcon}"
                               FontFamily="MaterialIcon"
                               VerticalTextAlignment="Center"
                               HorizontalTextAlignment="Center"
                               FontSize="24"
                               TextColor="Red"/>
                    </Border>
                    <Label Text="Delete"
                           FontSize="12"
                           HorizontalOptions="Center"
                           TextColor="Gray"/>
                </VerticalStackLayout>

                <!-- Add Product -->
                <VerticalStackLayout Grid.Row="2" HorizontalOptions="Center">
                    <Border StrokeThickness="0"
                            StrokeShape="RoundRectangle 25"
                            BackgroundColor="{StaticResource Primary}"
                            HeightRequest="50"
                            WidthRequest="50"
                            HorizontalOptions="Center">
                        <Label Text="+"
                               FontFamily="MaterialIcon"
                               VerticalTextAlignment="Center"
                               HorizontalTextAlignment="Center"
                               FontSize="30"
                               TextColor="White"/>
                    </Border>
                    <Label Text="Add Product"
                           FontSize="12"
                           HorizontalOptions="Center"
                           TextColor="Gray"/>
                </VerticalStackLayout>

            </Grid>
        </Grid>

        <!-- PRODUCTS SECTION -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="16" Margin="0,0,0,30">

                <!-- Search Bar -->
                <Border Stroke="{StaticResource Gray300}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 25"
                        Padding="0"
                        HorizontalOptions="Fill">
                    <SearchBar Placeholder="Search Product..."/>
                </Border>

                <!-- Products List -->
                <CollectionView ItemsSource="{Binding ShopProducts}"
                                SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="16"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:Product">
                            <Border StrokeThickness="0.4"
                                    StrokeShape="RoundRectangle 16"
                                    BackgroundColor="White"
                                    Padding="10"
                                    HorizontalOptions="Fill">
                                <Border.Shadow>
                                    <Shadow Brush="Black" Opacity="0.08" Radius="8" Offset="1,2"/>
                                </Border.Shadow>

                                <Grid ColumnDefinitions="120, *, Auto" ColumnSpacing="16" HorizontalOptions="Fill">

                                    <!-- Product Image -->
                                    <Border Grid.Column="0"
                                            HeightRequest="140"
                                            WidthRequest="120"
                                            StrokeThickness="0"
                                            StrokeShape="RoundRectangle 12">
                                        <Image Source="{Binding ImageUrl}"
                                               Aspect="AspectFill"
                                               HorizontalOptions="Fill"
                                               VerticalOptions="Fill"/>
                                    </Border>

                                    <!-- Product Info -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Start">
                                        <Label Text="{Binding Name}"
                                               Style="{StaticResource Title}"
                                               LineBreakMode="TailTruncation"
                                               MaxLines="2"
                                               HorizontalOptions="Start"/>

                                        <Label Text="{Binding FormattedDate}"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray100}}"/>

                                        <Label Text="{Binding FormattedLastUpdated}"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray100}}"/>
                                    </VerticalStackLayout>

                                    <!-- Price -->
                                    <Grid Grid.Column="2" RowSpacing="8" HorizontalOptions="End" RowDefinitions="auto, *">
                                        <Label Text="{Binding FormattedPrice}"
                                               HorizontalOptions="End"
                                               Grid.Row="0"
                                               VerticalOptions="Start"
                                               Style="{StaticResource BigPrice}"/>

                                        <Border BackgroundColor="{StaticResource Primary}"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 20"
                                                Padding="12,6"
                                                HorizontalOptions="End"
                                                VerticalOptions="End"
                                                Grid.Row="1">
                                            <HorizontalStackLayout>
                                                <Label Text="View"
                                                      Style="{StaticResource ButtonLabelText}"
                                                       VerticalTextAlignment="Center"/>
                                                <Label Text="{x:Static icon:Icons.getStartedIcon}"
                                                       Style="{StaticResource MaterialIcon}"
                                                       TextColor="{StaticResource White}"/>
                                            </HorizontalStackLayout>
                                        </Border>
                                    </Grid>

                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Optional: Empty State -->
                <!--
                <Label Text="No products found. Add one to get started!"
                       FontSize="16"
                       HorizontalOptions="Center"
                       IsVisible="{Binding IsEmpty}"
                       Margin="0,60,0,0"/>
                -->

            </VerticalStackLayout>
        </ScrollView>

    </Grid>
</ContentPage>