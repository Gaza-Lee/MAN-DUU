<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:icons="clr-namespace:MANDUU.Helpers"
             xmlns:enumeration="clr-namespace:MANDUU.Enumeration"
             xmlns:convertor="clr-namespace:MANDUU.Converters"
             x:Class="MANDUU.Views.MainPages.SubPages.CheckoutAndPayment.PaymentPage"
             Shell.TabBarIsVisible="False"
             Title="Payment">

    <ContentPage.Resources>
        <ResourceDictionary>
            <convertor:SelectedPaymentMethodBackgroundConvertor  x:Key="SelectedPaymentMethodBackground"/>
            <convertor:EnumToBoolConverter x:Key="EnumToBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <ScrollView>
        <Grid RowDefinitions="auto,auto,*" Margin="10,0" RowSpacing="10">
            <Label Text="Complete payment"
                   FontSize="18"
                   FontFamily="Finlandica" Grid.Row="0"/>
            <Border Grid.Row="1"
                    StrokeThickness="0.5"
                    StrokeShape="RoundRectangle 10"
                    VerticalOptions="Start"
                    Padding="10,5">
                <Grid RowDefinitions="auto,*,auto,auto" ColumnDefinitions="*,*,*" RowSpacing="15" ColumnSpacing="10">
                    <!--First row-->
                    <Label Text="Payment Summary" 
                           Grid.Row="0"
                           Grid.Column="0"
                           Grid.ColumnSpan="2"
                           FontFamily="Finlandica"/>
                    <Label Grid.Row="0"
                           Grid.Column="2"
                           FontFamily="Finlandica"
                           TextColor="{AppThemeBinding Dark={StaticResource Gray100}, Light={StaticResource Gray600}}"
                           Text="{Binding OrderNumber}"
                           FontSize="12"
                           VerticalOptions="Center"
                           VerticalTextAlignment="Center"
                           HorizontalOptions="End"/>

                    <!--second row-->
                    <Label Text="Item(s):"
                           Grid.Row="1"
                           Grid.Column="0" 
                           FontFamily="Finlandica"/>
                    <Label Text="{Binding CartItemsNames}"
                           Grid.Row="1"
                           LineBreakMode="TailTruncation"
                           MaxLines="2"
                           Grid.Column="1"
                           Grid.ColumnSpan="2"
                           FontFamily="Finlandica"/>

                    <!--Third row-->
                    <Label Text="Delivery Fee: "
                           Grid.Row="2"
                           Grid.Column="0"
                           FontFamily="Finlandica"/>
                    <Label Text="Residential Address"
                           Grid.Column="1"
                           Grid.Row="2"
                           LineBreakMode="TailTruncation"
                           FontFamily="Finlandica"/>
                    <Label Text="{Binding DeliveryFee, StringFormat='₵ {0:N2}'}"
                           Grid.Column="2"
                           Grid.Row="2"
                           FontFamily="Finlandica"
                           HorizontalOptions="End"
                           TextColor="{StaticResource Primary}"/>

                    <!--Last row-->
                    <Label Text="Total Amount: "
                           Grid.Row="3"
                           Grid.Column="0"
                           FontFamily="Finlandica"/>
                    <Label Grid.Row="3"
                           Grid.Column="1"
                           Text="{Binding CartTotal, StringFormat='₵ {0:N2}'}"
                           Grid.ColumnSpan="2"
                           VerticalTextAlignment="Center"
                           FontSize="20"
                           TextColor="{StaticResource Primary}"
                           HorizontalOptions="Start"
                           FontFamily="Finlandica"/>
                </Grid>
            </Border>
            <Border Grid.Row="2"
                    StrokeShape="RoundRectangle 10"
                    Padding="10,5">
                <Grid RowSpacing="10" RowDefinitions="auto,auto, *">
                    <VerticalStackLayout Grid.Row="0">
                        <Label  Text="Payment Method"
                                FontFamily="Finlandica"
                                FontSize="18"/>
                        <HorizontalStackLayout>
                            <Label Text="{x:Static icons:Icons.infoIcon}" 
                                   FontFamily="MaterialIcon"
                                   FontSize="16"
                                   VerticalTextAlignment="Center"/>
                            <Label Text="Select how you would like to pay for your order"
                                   FontSize="Small"
                                   FontFamily="Finlandica"
                                   VerticalTextAlignment="Center"/>
                        </HorizontalStackLayout>                        
                    </VerticalStackLayout>

                    <Border BackgroundColor="{AppThemeBinding Dark={StaticResource Gray600}, Light={StaticResource Gray100}}"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 5"
                            Grid.Row="1">
                        <Border.Shadow>
                            <Shadow Brush="{AppThemeBinding Dark={StaticResource Gray950}, Light={StaticResource Gray600}}"
                                    Offset="5,5"
                                    Opacity="0.5"/>
                        </Border.Shadow>
                        <Grid Padding="5" ColumnSpacing="20" ColumnDefinitions="*,*,*">
                            
                            <Border StrokeThickness="0"
                                    StrokeShape="RoundRectangle 10"
                                    Padding="10,5"
                                    BackgroundColor="{Binding SelectedPaymentMethod, Converter={StaticResource SelectedPaymentMethodBackground},
                                                    ConverterParameter=MobileMoney}"
                                    Grid.Column="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SelectPaymentMethodCommand}" 
                                            CommandParameter="{x:Static enumeration:PaymentMethod.MobileMoney}" />
                                </Border.GestureRecognizers>
                                <Label Text="Mobile Money"
                                       FontFamily="Finlandica"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       InputTransparent="True"/>
                            </Border>

                            <Border StrokeThickness="0"
                                    StrokeShape="RoundRectangle 10"
                                    Padding="10,5"
                                    BackgroundColor="{Binding SelectedPaymentMethod, Converter={StaticResource SelectedPaymentMethodBackground},
                                        ConverterParameter=Card}"
                                    Grid.Column="1">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SelectPaymentMethodCommand}" 
                                                          CommandParameter="{x:Static enumeration:PaymentMethod.Card}" />
                                </Border.GestureRecognizers>
                                <Label Text="Card"
                                       FontFamily="Finlandica"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       InputTransparent="True"/>
                            </Border>

                            <Border StrokeThickness="0"
                                    StrokeShape="RoundRectangle 10"
                                    Padding="10,5"
                                    BackgroundColor="{Binding SelectedPaymentMethod, Converter={StaticResource SelectedPaymentMethodBackground},
                                                ConverterParameter=BankTransfer}"
                                    Grid.Column="2">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SelectPaymentMethodCommand}" 
                                                          CommandParameter="{x:Static enumeration:PaymentMethod.BankTransfer}" />
                                </Border.GestureRecognizers>
                                <Label Text="Bank Transfer"
                                       FontFamily="Finlandica"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       InputTransparent="True"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!--Mobile Money-->
                    <Grid Grid.Row="2" Margin="10,5" RowSpacing="10" RowDefinitions="auto,auto,*,*"
                          IsVisible="{Binding SelectedPaymentMethod, Converter={StaticResource EnumToBoolConverter},
                                        ConverterParameter=MobileMoney}">
                        <Border StrokeThickness="0.5"
                                StrokeShape="RoundRectangle 10"
                                Grid.Row="0">
                            <Picker Title="Select Network"
                                Margin="10,0"/>
                        </Border>
                        <VerticalStackLayout Grid.Row="1">
                            <Label Text="Mobile Number"
                                   FontFamily="Finlandica"
                                   TextColor="{AppThemeBinding Dark={StaticResource Gray100}, Light= {StaticResource Gray600}}"/>
                            <Border StrokeThickness="0.5"
                                    StrokeShape="RoundRectangle 10">
                                <Entry />
                            </Border>
                            <HorizontalStackLayout Margin="0,5">
                                <Label Text="{x:Static icons:Icons.infoIcon}"
                                       FontFamily="MaterialIcon"
                                       VerticalTextAlignment="Center"/>
                                <Label Text="Enter Phone number to be used for payment"
                                       FontFamily="Finlandica"/>
                            </HorizontalStackLayout>                            
                        </VerticalStackLayout>

                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 10"
                                BackgroundColor="#145CEC"
                                Padding="10,5" 
                                Grid.Row="2">
                            <VerticalStackLayout>
                                <HorizontalStackLayout Spacing="5">
                                    <Label Text="{x:Static icons:Icons.infoIcon}"
                                           FontFamily="MaterialIcon"
                                           VerticalOptions="Center"
                                           VerticalTextAlignment="Center"
                                           FontSize="20"/>
                                    <Label Text="Payment Process"/>
                                </HorizontalStackLayout>
                                <VerticalStackLayout Margin="30,5">
                                    <Label Text="1. You will receive a payment prompt on your phone" 
                                           FontFamily="Finlandica"
                                           FontSize="12"/>
                                    <Label Text="2. Enter Mobile Money PIN to confirm" 
                                           FontFamily="Finlandica"
                                           FontSize="12"/>
                                    <Label Text="3. Payment will be processed instantly" 
                                           FontFamily="Finlandica"
                                           FontSize="12"/>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                        
                        <Button Text="{Binding CartTotal, StringFormat='Pay ₵ {0:N2}'}"
                                TextColor="{StaticResource White}"
                                BackgroundColor="{StaticResource Primary}"
                                HorizontalOptions="Center"
                                Padding="100,0"
                                Grid.Row="3"
                                VerticalOptions="End"
                                Margin="0,0,0,50"/>
                    </Grid>

                    <!-- Card Section -->
                    <Grid Grid.Row="2" 
                          IsVisible="{Binding SelectedPaymentMethod, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Card}"
                          Margin="10,5">
                        <Label Text="Card payment form coming soon..."
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               FontSize="16"/>
                    </Grid>

                    <Grid Grid.Row="2" 
                          IsVisible="{Binding SelectedPaymentMethod, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=BankTransfer}"
                          Margin="10,5">
                        <Label Text="Bank transfer instructions coming soon..."
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               FontSize="16"/>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </ScrollView>
</ContentPage>